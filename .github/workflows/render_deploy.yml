name: CI/CD Pipeline for Render Deployment

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    name: "ğŸ§ª Tests et Validation"
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Run tests
      run: |
        echo "ğŸ§ª ExÃ©cution des tests..."
        python tests/test_complete.py
        echo "âœ… Tests passÃ©s avec succÃ¨s!"
    
    - name: Test Docker build
      run: |
        echo "ğŸ‹ Test de construction Docker..."
        docker build -t amazoncomment-test .
        echo "âœ… Image Docker construite avec succÃ¨s!"

  notify-render:
    name: "ğŸš€ Notification de dÃ©ploiement"
    runs-on: ubuntu-latest
    needs: test
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: Notify deployment
      run: |
        echo "ğŸš€ Tests rÃ©ussis! Render va automatiquement dÃ©ployer..."
        echo "ğŸ“ URL de dÃ©ploiement: https://amazoncomment-api.onrender.com"
        echo "ğŸ“– Documentation: https://amazoncomment-api.onrender.com/docs"